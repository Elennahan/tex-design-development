\def\fileversion{v1.0}
\def\filename{livroaberto}
\def\filetitle{Livro Aberto package}
\def\filedate{2018/02/13}
\def\docdate {2018/02/13}

%Combinação dos pacotes usados para o livro aberto
%Para acessar cada seção basta usar Ctrl+F

%Seção 1 - Livro Aberto Boxes
%Seção 2 - Livro Aberto Colors
%Seção 3 - Livro Aberto Fonts
%Seção 4 - Livro Aberto Headings
%Seção 5 - Livro Aberto Lists
%Seção 6 - Livro Aberto Page 

\RequirePackage{colortbl}
\RequirePackage{ifthen}
\RequirePackage[export]{adjustbox}
\RequirePackage{xparse}% For RenewDocumentEnvironment
\RequirePackage{tcolorbox} %Allow those nice environments
\RequirePackage{titling} % needed to manage with the title
\RequirePackage{eso-pic }% to the cover style
\RequirePackage{tikz}
\usetikzlibrary{intersections, positioning, fit, backgrounds, shapes, fadings,
decorations.pathmorphing, graphs, quotes, angles, calc, through, backgrounds}
\RequirePackage{comment}
\RequirePackage{ltxcmds}
\RequirePackage{amstext}
\RequirePackage{textcomp}% "warn" option issued from template
%\RequirePackage{titlesec}
\RequirePackage{tabulary}
\RequirePackage{longtable}
\RequirePackage{makeidx}
\RequirePackage{fancyvrb}
\RequirePackage{wrapfig}
\RequirePackage{parskip}[=v1]
\RequirePackage{parskip}
\RequirePackage{alltt}
\RequirePackage{upquote}
\RequirePackage{capt-of}
\RequirePackage{needspace}
\RequirePackage{mathtools}
\ltx@ifundefined{@removefromreset}
{\RequirePackage{remreset}}
\RequirePackage{atbegshi}
\RequirePackage{kvoptions}
\RequirePackage{sphinx}
\@ifclassloaded{memoir}{}{\RequirePackage{fancyhdr}}
\RequirePackage{etoolbox}
\RequirePackage{framed}

\tcbuselibrary{skins,breakable}
\RequirePackage{graphicx}
\@ifclassloaded{memoir}{}{\RequirePackage{fancyhdr}}



%Seção 1 - Livro Aberto Boxes
%***************************************************************************************
% This package creates and typesets the text boxes for the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems

% \def\fileversion{v1.0}
% \def\filename{livroabertoboxes}
% \def\filetitle{Livro Aberto Text Boxes package}
% \def\filedate{2018/02/13}
% \def\docdate {2018/02/13}


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{\filename}

\typeout{Package: `\filetitle\space\filename\space\fileversion \@spaces <\filedate>'}
\typeout{English documentation as of <\docdate>}

%% ---------------------------------------------------------------------
%%
%% Loads the ifthen package
%%
\RequirePackage{ifthen}
\RequirePackage{mfirstuc} %To capitalize just the inicial letter of each word. There is a command to exclude specific words to captalize such like a, an, the, etc.
\RequirePackage{anyfontsize} %To define fontsize precisely

\tikzstyle{outlinebox} = [fill=box2]
\tikzstyle{box} = [inner sep=3mm, inner ysep=3mm]

% Define the vertical skip for the environments
\newskip\libroskip
\libroskip= 4pt plus 1pt minus 1pt

\def\envskip{\vskip\libroskip}

\newtcolorbox{teacher}[2][]{parbox=false,%
enhanced,width=\linewidth-6pt,
enlarge top by=3pt,enlarge bottom by=3pt,
enlarge left by=3pt,enlarge right by=3pt,
title={#2},frame hidden,boxrule=0pt,top=1mm,bottom=1mm,
colframe=green!30!black, colbacktitle=green!50!yellow,
coltitle=black, colback=green!25!white,
borderline={0.5pt}{-0.5pt}{green!75!blue},
borderline={1pt}{-3pt}{green!50!blue},#1}

\newtcolorbox{answer}[2][]{parbox=false,%
enhanced,width=\linewidth-6pt,
enlarge top by=3pt,enlarge bottom by=3pt,
enlarge left by=3pt,enlarge right by=3pt,
title={#2},frame hidden,boxrule=0pt,top=1mm,bottom=1mm,
colframe=green!30!black, colbacktitle=green!50!yellow,
coltitle=black, colback=green!25!white,
borderline={0.5pt}{-0.5pt}{green!75!blue},
borderline={1pt}{-3pt}{green!50!blue},#1}




\newtcolorbox{task}[1]{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=0.3mm, right=0.8mm, top=5mm, bottom=3mm, colback=white, colframe=cor2!70, width=162mm, 
%borderline west={3mm}{0pt}{white}, 
  toprule=0pt,
  bottomrule=0.5pt,
  rightrule=-1pt,
  leftrule=-1pt,
  outer arc = 3mm,
  arc = 3mm,
  sharp corners = northeast,
  sharp corners = southeast,
  sharp corners = southwest,
  fontupper=\fontsize{11}{15.5}\boxexample, % Should be 11 pt.
fonttitle=\boxtitlefont\large,  % Should be 9 pt. Don't know how to set this. Tried \fontsize{9pt}{}, but didn't work.
coltitle=\currentcolor,
title=\makefirstuc{#1\hfill}, 
boxed title style={empty,arc=1pt,outer arc=1pt,boxrule=1pt}, 
attach boxed title to top left={xshift=-1 mm , yshift=-0.1mm},
underlay boxed title ={
% Draw the small arc on the top left.
\draw[cor2!70, line width = 1pt] ($(title.south west)+(3mm,0mm)$) coordinate (LU) arc [start angle=90, end angle=180, y radius=2mm, x radius=2mm] --++ (0mm , -2mm);
% Draw the top line from the left to the right.
\draw[cor2!70,  line width=1pt] (LU) -- ++ (158mm,0mm) coordinate (R);
% Think on the Atividade box as an ABCD rectangle (clockwise, A is top left), now you see the coordinates. 
\fill [cor2!70] ($(R)+(0mm,-.2mm)$) -- ++ (-23.00mm,0mm) coordinate (D) --++ (0mm, 5mm) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ++ (23.00mm,0mm) coordinate (B) --++ (0.00mm,-5mm)  arc [start angle=0, end angle=-90, y radius=2.00mm, x radius=2.00mm] -- cycle;
\node[font=\titlefont\large,white] at ($(B)!0.5!(D)$) {\small Atividade};
}
}



% Makes the "To think about" box.
% It is missing to set title font and font size. After that should check if the title is centralized in the title box.
\newtcolorbox{reflection}{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=6mm, bottom=3mm, colback=white, colframe=box1, borderline west={3mm}{0pt}{white}, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=-1pt, outer arc = 3mm, arc = 3mm, 
fonttitle=\bfseries\large\boxtitlefont,  % Should be 12 pt. Don't know how to set this.
title=PARA REFLETIR, 
boxed title style={empty,arc=0pt,outer arc=0pt,boxrule=0pt}, 
attach boxed title to top left={xshift=3mm , yshift=-2.5mm},
underlay boxed title={
\filldraw [draw=box1, fill=box1] ($(title.north west) + (0 mm,-2.50mm)$) -- ++(0.00mm,1.50mm) arc [start angle=180, end angle=90, y radius=2.00mm, x radius=2.00mm] -| ++(34.00mm,-5.00mm) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -| cycle;}
}


%\NewEnviron{reflection}{%
%        \envskip
%        \begin{tikzpicture}
%            \begin{pgfonlayer}{main}
%                \node [box] (box) {%
%                    \begin{minipage}{0.90\textwidth}
%                    \BODY			
%                    \end{minipage}
%	};
%            \end{pgfonlayer}

%        	\begin{pgfonlayer}{background}
%            	\draw [draw=box1] (box.south west) -- ($(box.south east) + (-2.00mm,0.00mm)$) coordinate (O) arc [start angle=270, end angle=360, x radius=2.00mm, y radius=2.00mm] -- ($(box.north east) + (0.00mm,1.50mm)$) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ($(box.north west) + (0.00mm,3.50mm)$) coordinate (a);
%            	\filldraw [draw=box1, fill=box1] (a) -- ++(0.00mm,1.50mm) arc [start angle=180, end angle=90, y radius=2.00mm, x radius=2.00mm] -| ++(37.00mm,-5.00mm) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -| cycle;	
%            \end{pgfonlayer}
%	
%        \coordinate (b) at ($(a) + (37.00mm,0.00mm)$);
%	
%            \begin{pgfonlayer}{foreground}
%                \node [text=white] (text) at ($(a)!0.5!(b)$) {\large\sffamily\bfseries PARA REFLETIR};	
%            \end{pgfonlayer}
%        \end{tikzpicture}
%}

% Observation Box

\newtcolorbox{observation}[1]{parbox=false, enhanced, breakable, left=3mm, right=3mm, top=3mm, bottom=2mm, colback=box2!50, colframe=box2!50, arc=3mm, sharp corners=uphill, pad at break=2mm, drop fuzzy shadow, title={\bfseries\textcolor{\currentcolor}{ #1}}, attach boxed title to top center={xshift=0mm, yshift=-5.5mm}, boxed title style ={empty}}	 


%\NewEnviron{observation}{%
%    \envskip
%    \begingroup
%            \begin{tikzpicture}
%                \begin{pgfonlayer}{main}
%                    \node [box] (box) {%
%                    \begin{minipage}{0.90\textwidth}
%                    \BODY			
%                    \end{minipage}	
%                    };
%                \end{pgfonlayer}

%                \begin{pgfonlayer}{background}
%                    \filldraw [fill=box2, draw=box2] (box.south west) -- ($(box.north west) + (0.00mm,-2.00mm)$) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -| ($(box.south east) + (0.00mm,2.00mm)$) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -- cycle;
%                \end{pgfonlayer}
%            \end{tikzpicture}
%    \endgroup
%    }


\newtcolorbox{example}[1]{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=10mm, bottom=3mm, colback=white, colframe=cor1, width=162mm, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=1pt, outer arc = 8mm, arc = 8mm, sharp corners = northwest, sharp corners = southeast, sharp corners = southwest,
title={{\boxfont EXEMPLO}\hspace{3.5mm} \textcolor{gray!80!black}{\Large\extitlefont\makefirstuc{#1}}}, 
boxed title style={empty, sharp corners}, 
attach boxed title to top left={xshift=-1.3 mm , yshift=-10mm},
underlay boxed title ={
% Draw the title underlay rectangle
\fill[cor1!30] ($(frame.north west) + (0,-.5mm)$) rectangle ($(title.north east)+(-.8mm,-8.5mm)$) coordinate (R);
%)
%;
% Filldraw the darker fancy in front of the rectangle and behind the Example. The coordinates should be better chosen.
\fill[cor1] (frame.north west) -- ($(title.south west) + (1.3mm,0)$) -- ++ (18mm,0mm) arc [start angle=-90, end angle=0, x radius = 2mm, y radius = 2mm] -- ($(frame.north west) + (20mm,0)$) --  cycle;


}
}

\newtcolorbox{research}{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=6mm, bottom=3mm, colback=white, colframe=box3, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=1pt, outer arc = 3mm, arc = 3mm, sharp corners = northwest,
fonttitle=\normalsize\boxtitlefont,  
title= PARA PESQUISAR, 
boxed title style={empty, colback = box3, colframe = box3, sharp corners}, 
attach boxed title to top left={xshift=-2.5mm , yshift=-6.2mm},
underlay boxed title={
\filldraw [fill=box3, draw=box3] ($(frame.north west)$) rectangle +(36.00mm,-5.00mm);% the rectangle where the title fits.
\coordinate (A) at ($(frame.north west) + (36.00mm,0.00mm)$);
%\filldraw [cor1] ($(A) + (-4.7mm,0mm)$) rectangle ++(-7mm,-6.4mm);%green rectangle within ? inside.
%\fill [box3] ($(A) + (-11.9mm,-3.5mm)$) -- ++(4.8 mm,2.6 mm) arc [start angle=20, end angle=-60, x radius=1.00mm, y radius=2.35mm] --++ (0,-2mm)-- ($(title.south east) + (-1.1mm,0.20mm)$) -- ($(title.south east) + (-2mm,0.20mm)$) -- cycle; % the fancy thing in the ?
\node [white] at ($(A) + (-2.40mm,-1.6mm)$) {\includegraphics[height=7mm]{lupa}};% just the ?
}
}

%\NewEnviron{example}[1][]{%
%    \envskip
%	\begin{tikzpicture}
%	\begin{pgfonlayer}{main}
%	\node [box] (box) {%
%		\begin{minipage}{0.90\textwidth}
%		\BODY			
%		\end{minipage}	
%	};
%	\end{pgfonlayer}
%	
%	\begin{pgfonlayer}{main}
%		%%% Draw box outline
%		\draw [draw=cor1] ($(box.north west) + (0.00mm,7.00mm)$) coordinate (a) |- (box.south east) -- ($(box.north east) + (0.00mm,5.00mm)$) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -| cycle;
%		\filldraw [fill=cor1, draw=cor1] (box.north west) |- ++(30.00mm,7.00mm) coordinate (A)-- ++(0.00,-5.00mm) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] coordinate (B) -- cycle;
%		
%	\end{pgfonlayer}
%	
%	\begin{pgfonlayer}{background}
%		\filldraw [fill=cor2] (A) -| ++(5.00mm,-7.00mm) coordinate (C) -- (B) |- cycle;
%		\coordinate (D) at ($(A) + (2.00mm,-3.5mm)$);		
%	\end{pgfonlayer}

%	\begin{pgfonlayer}{foreground}
%		\node [right, text=white, minimum height=7.10mm, fill=cor2] (label) at (D) {\large\sffamily\bfseries #1};
%		\node [text=white] (text) at ($(a)!0.5!(B)$) {\large\sffamily\bfseries EXEMPLO};
%		\node [text=white] (heading) at (box.north east) {#1};
%	\end{pgfonlayer}	
%	
%	\end{tikzpicture}
%}



\newtcolorbox{knowledge}{parbox=false, blanker, enhanced, breakable, before skip = 5mm, after skip = 5mm, left=3mm, right=3mm, top=6mm, bottom=3mm, colback=white, colframe=box3, toprule=1pt, bottomrule=1pt, rightrule=1pt, leftrule=1pt, outer arc = 3mm, arc = 3mm, sharp corners = northwest,
fonttitle=\normalsize\boxtitlefont,  
title= VOC\^{E} SABIA, 
boxed title style={empty, colback = box3, colframe = box3, sharp corners}, 
attach boxed title to top left={xshift=-2.3mm , yshift=-5.5mm},
underlay boxed title={
\filldraw [fill=box3, draw=box3] ($(frame.north west) + (.4mm,0mm)$) rectangle ++(24.00mm,-5.00mm);% the rectangle where the title fits.
\coordinate (A) at ($(frame.north west) + (24.00mm,-2mm)$);
\node at (A) {\includegraphics[scale=1]{interrogacao.png}};
}
}

%\NewEnviron{knowledge}{%
%    \envskip
%	\begin{tikzpicture}
%	\begin{pgfonlayer}{main}
%	\node [box] (box) {%
%		\begin{minipage}{0.90\textwidth}
%		\BODY			
%		\end{minipage}	
%	};
%	\end{pgfonlayer}
%	
%	\coordinate (A) at ($(box.north west) + (36.00mm,0.00mm)$);
%	\begin{pgfonlayer}{background}
%	\draw [draw=box3] (box.north west) -- ($(box.south west) + (0.00mm,2.0mm)$) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] -- ($(box.south east) + (-2.00mm,0.00mm)$) arc [start angle=270, end angle=360, x radius=2.00mm, y radius=2.00mm] -- ($(box.north east) + (0.00mm,3.00mm)$) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -| cycle;
%	\filldraw [fill=box3, draw=box3] (box.north west) rectangle +(35.00mm,5.00mm);
%	\node [text=white, right] (title) at ($(box.north west) + (0.00mm,2.50mm)$) {\normalsize\sffamily\bfseries VOC\^{E} SABIA};	
%	\end{pgfonlayer}
%	
%	
%	\begin{pgfonlayer}{foreground}
%	\filldraw [fill=cor1, draw=cor1] (A) -- ++(-3.00mm,0.00mm) -- ++(1.00mm,1.00mm) arc [start angle=315, end angle=495, x radius=2.00mm, y radius=2.00mm] -- ++(-1.00mm,-1.00mm) -- ++(0.00mm,3.00mm) -| cycle;
%	\node [white] (question) at ($(A) + (-3.00mm,2.25mm)$) {{\Large\sffamily\bfseries ?}};
%	% \filldraw [draw=white, very thick, fill=magblue] ($(A) + (-3.00mm,3.00mm)$) circle (1.50mm);
%	% \draw [very thick, white] ($(A) + (-5.50mm,0.50mm)$) -- ++(1.00mm,1.00mm);
%	\end{pgfonlayer}
%	
	
%	\end{tikzpicture}
%}




%\NewEnviron{research}{%
%    \envskip
%	\begin{tikzpicture}
%	\begin{pgfonlayer}{main}
%		\node [box] (box) {%
%			\begin{minipage}{0.90\textwidth}
%				\BODY			
%			\end{minipage}	
%		};
%	\end{pgfonlayer}
%	
%	\coordinate (A) at ($(box.north west) + (40.00mm,0.00mm)$);
%	\begin{pgfonlayer}{background}
%		\draw [draw=box3] (box.north west) -- ($(box.south west) + (0.00mm,2.0mm)$) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] -- ($(box.south east) + (-2.00mm,0.00mm)$) arc [start angle=270, end angle=360, x radius=2.00mm, y radius=2.00mm] -- ($(box.north east) + (0.00mm,3.00mm)$) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -| cycle;
%		\filldraw [fill=box3, draw=box3] (box.north west) rectangle +(40.00mm,5.00mm);
%		
%	\end{pgfonlayer}
%	
%	
%	\begin{pgfonlayer}{foreground}
%		\filldraw [fill=cor1, draw=cor1] (A) -- ++(-3.00mm,0.00mm) -- ++(1.00mm,1.00mm) arc [start angle=315, end angle=495, x radius=2.00mm, y radius=2.00mm] -- ++(-1.00mm,-1.00mm) -- ++(0.00mm,3.00mm) -| cycle;
%		\filldraw [draw=white, very thick, fill=magblue] ($(A) + (-3.00mm,3.00mm)$) circle (1.50mm);
%		\draw [very thick, white] ($(A) + (-5.50mm,0.50mm)$) -- ++(1.00mm,1.00mm);
%		\node [text=white, right] (title) at ($(box.north west) + (0.00mm,2.50mm)$) {\normalsize\sffamily\bfseries PARA PESQUISAR};	
%	\end{pgfonlayer}	
%	
%	\end{tikzpicture}
%}

\NewEnviron{evaluation}{%
    \envskip
	\begin{tikzpicture}[remember picture]
		\begin{pgfonlayer}{main}
			\node [box] (box) {%
			\begin{minipage}{0.90\textwidth}
				\BODY			
			\end{minipage}	
			};
		\end{pgfonlayer}
		\begin{pgfonlayer}{main}
			\filldraw [fill=cor1, draw=cor1] (box.north west) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,6.00mm) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ++(3.00mm,0.00mm) coordinate (a) |- cycle;
			\node [draw=cor1, fill=cor1, minimum height=10.00mm, right] (heading) at ($(a) + (0.00mm,-5.00mm)$) {\Large AUTO-AVALIA\c{C}\={A}O};
			\filldraw [fill=cor1, draw=cor1] (heading.north east) -- ++(10.00mm,-10.00mm) coordinate (b) -| cycle;
		\end{pgfonlayer}
		
		\begin{pgfonlayer}{background}
			\draw [draw=cor1!30, line width=3.00mm, overlay] ($(box.north west) + (0.00mm,1.50mm)$) -| ($(box.south east) + (1.50mm,-1.50mm)$) -- ($(box.south west) + (-1.50mm,-1.50mm)$);
			\draw [draw=cor1, overlay] (b) -- (box.north east) -- (box.south east) -- ($(box.south west) + (-1.50mm,0.00mm)$);

%			\draw [draw=cor1!30, line width=3.00mm, overlay] ($(box.north west) + (0.00mm,1.50mm)$) -| ($(box.south east) + (1.50mm,-1.50mm)$) coordinate (d) -- ($(current page.north west)!(d)!(current page.south west)$) -- (d);
%			\draw [draw=cor1, overlay] (b) -- (box.north east) -- (box.south east) -- ($(box.south west) + (-15.00mm,0.00mm)$) coordinate (c) -- ($(current page.north west)!(c)!(current page.south west)$) -- (c);
		\end{pgfonlayer}	
		
	\end{tikzpicture}

}

\NewEnviron{project}{%
    \newpage
	\begin{tikzpicture}[remember picture, overlay]
		\coordinate (border1) at ($(current page text area.south east) + (0.00mm,8.00mm)$);
		\coordinate (border1a) at ($(border1) + (-5.00mm,2.00mm)$);
		\coordinate (border1b) at ($(current page text area.south west) + (11.00mm,10.00mm)$);
		\coordinate (border1c) at ($(current page text area.north west) + (11.00mm,-13.00mm)$);
        \coordinate (border1d) at ($(current page text area.south west) + (11.00mm,13.00mm)$);
		\coordinate (heading) at ($(current page text area.north west) + (32.50mm,-5.00mm)$);
		\coordinate (corner1) at ($(current page text area.north west) + (6.00mm,-10.00mm)$);
		\coordinate (corner2) at ($(current page text area.north east) + (-4.00mm,-10.00mm)$);
		\coordinate (corner3) at ($(current page text area.south east) + (0.00mm,10.00mm)$);
		\coordinate (corner4) at ($(current page text area.south west) + (10.00mm,6.00mm)$);
		\coordinate (text1) at ($(current page text area.north west) + (11.00,-12.50mm)$);
		\coordinate (text2) at ($(current page text area.south east) + (-2.50mm,8.50mm)$);
        \coordinate (bodytextpos) at ($(border1c) + (5.00mm,-3.00mm)$);
		
		\begin{pgfonlayer}{background}
			\draw [draw=base1, fill=base1] (current page text area.south west) rectangle (current page text area.north east);
            		\end{pgfonlayer}
		
		\begin{pgfonlayer}{main}
			\draw [fill=cor2, draw=cor2] (current page text area.north west) -- ++(0.00mm,-8.00mm) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] -| ++(63.00mm,8.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
			\draw [fill=base1!30, draw=base1!30] (corner1) -- (corner2) arc [start angle=90, end angle=0, x radius=4.00mm, y radius=4.00mm] -- (corner3) arc [start angle=0, end angle=-90, x radius=4.00mm, y radius=4.00mm] -- (corner4) arc [start angle=270, end angle=180, x radius=4.00mm, y radius=4.00mm] -- cycle;
			% \draw [green] (text1) rectangle (text2);
			\draw [black] (border1a) -- (border1b) -- (border1c) -| cycle;

		\end{pgfonlayer}
		
		\begin{pgfonlayer}{foreground}
			\node [color=base1!30, font=\titlefont\bfseries\fontsize{13pt}{0}\selectfont] (title) at (heading) {PROJECTO APLICADO};
            \node [box, below right] (bodytext) at (border1c){%
			\begin{minipage}{0.85\textwidth}
				\BODY			
			\end{minipage}	
			};
		\end{pgfonlayer}
		
		% \draw [blue] (border1) arc [start angle= 0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -- ++($(-\textwidth,0) + (10.00mm,0.00mm)$) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] |- ++($(\textwidth, \textheight) + (-8.00mm,-10.00mm)$) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] -- cycle;
		% \draw [blue,line width=2mm] (current page.south west) rectangle (current page.north east);
		
		
	\end{tikzpicture}
    \clearpage
}

%Seção 2 - Livro Aberto Colors

%***************************************************************************************
% This package sets up the colors used in the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
%
%
% The fonts used in this package:
% Title: Orbitron
% Main (Text): Exo 2
% Boxes: Roboto

% \def\fileversion{v1.0}
% \def\filename{livroabertocolors}
% \def\filetitle{Livro Aberto Colors package}
% \def\filedate{2018/02/13}
% \def\docdate {2018/02/13}


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{\filename}

\typeout{Package: `\filetitle\space\filename\space\fileversion \@spaces <\filedate>'}
\typeout{English documentation as of <\docdate>}

%% ---------------------------------------------------------------------
%%
%% Loads the ifthen package
%%
\RequirePackage{ifthen}

\RequirePackage{xkeyval}

\definecolor{cor1}{RGB}{0,165,157} %verde agua
\definecolor{cor2}{RGB}{73,85,93}
\definecolor{cor1a}{RGB}{0,165,157}
\definecolor{cor2a}{RGB}{73,85,93}
\definecolor{cor1b}{RGB}{251,181,0}
\definecolor{cor2b}{RGB}{73,85,93}

\definecolor{base1}{RGB}{184,202,213}
\definecolor{base2}{RGB}{221,223,80}

\definecolor{session1}{RGB}{0,94,176} %azul
\definecolor{session2}{RGB}{75,173,49} %verde
\definecolor{session3}{RGB}{183,13,40} %vinho
\definecolor{session4}{RGB}{236,107,16} %laranja

\definecolor{box1}{RGB}{71,30,129}
\definecolor{box2}{RGB}{225,221,146}
\definecolor{box3}{RGB}{108,27,98}

\definecolor{magblue}{RGB}{151,255,249}

% Set up options for color schemes
\newboolean{coloroptions}

\define@choicekey*+{colorchoices}{color options}[\val\coloroption]
    {option 1, option 2}{%
            \ifcase\coloroption\relax
                \definecolor{cor1}{RGB}{0,165,157}
                \definecolor{cor2}{RGB}{73,85,93}
                % \setboolean{coloroptions}{true}
            \or
                % \setboolean{coloroptions}{false}
                \definecolor{cor1}{RGB}{251,181,0}
                \definecolor{cor2}{RGB}{73,85,93}
            \fi
        }{%
            % \setboolean{coloroptions}{true}
            \definecolor{cor1}{RGB}{0,165,157}
            \definecolor{cor2}{RGB}{73,85,93}
        }

%Seção 3 - Livro Aberto Fonts

%***************************************************************************************
% This package sets up the fonts for the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
%
%
% The fonts used in this package:
% Title: Orbitron
% Main (Text): Exo 2
% Boxes: Roboto

% \def\fileversion{v1.0}
% \def\filename{livroabertofonts}
% \def\filetitle{Livro Aberto Fonts package}
% \def\filedate{2018/02/13}
% \def\docdate {2018/02/13}


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{\filename}

\typeout{Package: `\filetitle\space\filename\space\fileversion \@spaces <\filedate>'}
\typeout{English documentation as of <\docdate>}

%% ---------------------------------------------------------------------
%%
%% Loads the ifthen package
%%
\RequirePackage{ifthen}

\RequirePackage{fontspec}
\setmainfont[Path=Fontes/]{Exo2-Light.otf}[BoldFont=Exo2-Medium.otf, ItalicFont=Exo2-LightItalic.ttf, BoldItalicFont=Exo2-MediumItalic.ttf]
\newfontfamily{\titlefont}[Path=Fontes/]{orbitron-medium.otf}[BoldFont=orbitron-bold.otf]
\newfontfamily{\secondtitlefont}[Path=Fontes/]{orbitron-black.ttf}
\newfontfamily{\thirdtitlefont}[Path=Fontes/]{orbitron-bold.otf}
\newfontfamily{\pagetitlefont}[Path=Fontes/]{Orbitron-Regular.ttf}
\newfontfamily{\boxfont}[Path=Fontes/]{Roboto-Regular.ttf}
\newfontfamily{\enumeratefont}[Path=Fontes/]{Exo2-Light.otf}[BoldFont=Exo2-Medium.otf, ItalicFont=Exo2-LightItalic.ttf, BoldItalicFont=Exo2-MediumItalic.ttf]
\newfontfamily{\boxtitlefont}[Path=Fontes/]{Exo2-Bold.otf}[BoldFont=Exo2-ExtraBold.ttf, ItalicFont=Exo2-BoldItalic.ttf, BoldItalicFont=Exo2-ExtraBoldItalic.ttf] % added after David
\newfontfamily{\extitlefont}[Path=Fontes/]{Exo2-SemiBold.otf} % added after David
\newfontfamily{\boxexample}[Path=Fontes/]{Exo2-Regular.otf}[BoldFont=Exo2-SemiBold.ttf, ItalicFont=Exo2-RegularItalic.ttf, BoldItalicFont=Exo2-MediumItalic.ttf] % added after David

%Seção 4 - Livro Aberto Headings

%***************************************************************************************
% This package creates the heading designs for the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
%
%

% \def\fileversion{v1.0}
% \def\filename{livroabertoheadings}
% \def\filetitle{Livro Aberto Headings package}
% \def\filedate{2018/02/13}
% \def\docdate {2018/02/13}


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{\filename}

\typeout{Package: `\filetitle\space\filename\space\fileversion \@spaces <\filedate>'}
\typeout{English documentation as of <\docdate>}

%% ---------------------------------------------------------------------
%%
%% Loads the ifthen package
%%
\RequirePackage{ifthen}

% Commands for chapter page
\newcommand\chapterillustration{}
\newcommand\chapterwhat{}
\newcommand\chapterbecause{}


% Create box shape
\pgfdeclareshape{howbecausetextbox}{%
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]

    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}
    \inheritanchor[from=rectangle]{north west}
    \inheritanchor[from=rectangle]{north east}
    \inheritanchor[from=rectangle]{south east}
    \inheritanchor[from=rectangle]{south west}

    \backgroundpath{%
        \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
% Construct main path
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya+5pt}}
        \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya+5pt}}
        \pgfpatharc{0}{-90}{5.0pt}
        \pgfpathlineto{\pgfpoint{\pgf@xa+5pt}{\pgf@ya}}
        \pgfpatharc{270}{180}{5.0pt}
%        \pgfpathcurveto{\pgfpoint{\pgf@xc}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@yc}}
        \pgfpathclose
    }
}

\pgfdeclareshape{howbecauseheadingbox}{%
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]

    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}
    \inheritanchor[from=rectangle]{north west}
    \inheritanchor[from=rectangle]{north east}
    \inheritanchor[from=rectangle]{south east}
    \inheritanchor[from=rectangle]{south west}

    \backgroundpath{%
        \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
% Construct main path
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpatharc{90}{0}{7.0pt}
        \pgfpathlineto{\pgfpoint{\pgf@xb+7pt}{\pgf@ya+7.0pt}}
        \pgfpatharc{0}{-90}{7.0pt}
        \pgfpathclose
    }
}

% box for O que? and Por que?, still not finished.
%\newtcolorbox{openningbox}{enhanced, jigsaw, opacityframe=.3, opacityfill=.3, width=80mm, left=3mm, right=3mm, top=10mm, bottom=2mm, colback=white, colframe=white, arc=3mm, sharp corners=uphill, coltitle=cor2, lower separated=false, fonttitle=\bfseries\fontsize{13pt}{0}\selectfont\titlefont, title={O QU\^E?},
%boxed title style={empty,arc=0pt,outer arc=0pt,boxrule=0pt}, 
%attach boxed title to top left={ yshift=-10 mm},
%underlay boxed title={
%\fill[cor1] ($(title.north west) + (0,-7mm)$) coordinate (x1) -- ++ (23 mm,0mm) arc [start angle=-90, end angle=90, x radius=3mm, y radius=3mm] coordinate (x2) -- ++ (-23 mm,0mm) -- cycle;
%% The position below should be relative the the top of the lower part of the box and not absolute.
%\fill[cor1] ($(frame.north west) + (0,-53mm)$) coordinate (c1) -- ++ (31 mm,0mm) arc [start angle=-90, end angle=90, x radius=3mm, y radius=3mm] coordinate (c2) -- ++ (-31 mm,0mm) -- cycle;
%\node[right] at ($(c1)!0.5!(c2)+ (-14mm,0)$) {\bfseries\fontsize{13pt}{0}\selectfont\titlefont\textcolor{cor2}{POR QU\^E?}};}
%}

\newtcolorbox{openningbox}{
  enhanced,
%  jigsaw,
  opacityframe=.3,
  opacityfill=.3,
  width=80mm,
  left=3mm,
  right=3mm,
  top=3mm,
  bottom=.5mm,
  colback=white,
  colframe=white,
  arc=3mm,
  sharp corners=uphill,
    % frame empty,
    % arc = 8pt,
    lower separated = false,
    before upper = \tcbsubtitle{O QU\^E?},
    before lower = \tcbsubtitle{POR QU\^E?},
    fontupper = \sffamily,
    fontlower = \sffamily,
    sharp corners = north,
    subtitle style = {
      frame empty,
      fontupper = \fontsize{13pt}{0}\selectfont\titlefont\bfseries,
      colback = cor1,
      coltext = black!70,
      width = 3.5cm,
      arc = 8pt,
      rounded corners = east
    }
  }

\newcommand{\ChapNumTitle}[1]{%
  % \thispagestyle{plain}
  \thispagestyle{empty}
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (a) at ($(current page.north west) + (44.00mm,-44.00mm)$);
        \coordinate (c) at ($(current page.north west) + (148.54mm,-64.82mm)$);
        \coordinate (d) at ($(current page.north) + (0.00mm,-78.57mm)$);

        \begin{pgfonlayer}{top}
        \filldraw [fill=cor1, draw=cor1] ($(a) + (0.00mm,-25.00mm)$) -- ++(22.00mm,0.0mm) arc [start angle=270, end angle=360, x radius = 3.00mm, y
        radius=3.00mm] coordinate (c1) -- ++(0.00mm,44.00mm) coordinate (c2) arc [start angle=0, end angle=90, x radius=3.00mm, y radius=3.00mm] --
        ++(-44.00mm,0.00mm) arc [start angle=90, end angle=180, x radius=3.00mm, y radius=3.00mm] -- ++(0.00mm,-44.00mm) arc [start angle=180, end
        angle=270, x radius=3.00mm, y radius=3.00mm] -- cycle;
        \node[font=\chapnumfont, text=cor2] at (a) {\chapnamefont\thechapter};

        \coordinate (b) at ($(c1)!0.5!(c2)$);
        \node (title) at (b) [right, font=\chaptitlefont, text=cor2] {\begin{varwidth}{12cm}\baselineskip=1cm #1\end{varwidth}};
        % solution to the box O QUE and POR QUE?
        \node [right] at ($(current page.north)+(-15mm,-150mm)$) %
        {\begin{openningbox}
            \chapterwhat

            \tcblower

            \chapterbecause

            \end{openningbox}};


                                      
%        \node [right, shape=howbecauseheadingbox, fill=cor1, text=cor2, font=\bfseries\fontsize{13pt}{0}\selectfont\titlefont] (whatbox) at (d) {O QUE?};
%        \node [yshift=-10.00mm, text=black, text width=79.25mm, right] (whytext) at (whatbox.south west) {\indent \chapterwhat};
%        \node [yshift=-8.00mm, right, shape=howbecauseheadingbox, fill=cor1, text=cor2, font=\bfseries\fontsize{13pt}{0}\selectfont\titlefont] (becausebox) at (whytext.south west) {POR QUE?};
%        \node [yshift=-19.00mm, text=black, text width=79.25mm, right] (becausetext) at (becausebox.south west) {\indent \chapterbecause};
        \end{pgfonlayer}

        % \begin{pgfonlayer}{background}
        %     \node [shape=howbecausetextbox, fill=white, fit={(whatbox) (whytext) (becausebox) (becausetext)}] (howbecausetextbox) {};
        % \end{pgfonlayer}

        \begin{pgfonlayer}{bottom}
            \node[opacity=0.3,inner sep=0pt] at (current page.center){\includegraphics[width=\paperwidth,height=\paperheight]{\chapterillustration}};
        \end{pgfonlayer}

%%%        \begin{pgfonlayer}{main}
%%%            \filldraw [fill=cor2] plot [smooth] coordinates {($(current page.north west) + (0.00mm,-15.00mm)$) ($(current page.north east) + (-70.00mm,-74.64mm)$) ($(current page.north east) + (0.00mm,-66.79mm)$)} -- (current page.north east) -| cycle;
%%%            \filldraw [fill=cor1] plot [smooth] coordinates {($(current page.north west) + (0.00mm,-12.00mm)$) ($(current page.north west) + (120.00mm,-30.00mm)$) ($(current page.north east) + (-25.00mm,0.00mm)$)} -| cycle;
%%%%            \filldraw [fill=cor1] plot [smooth] coordinates {($(current page.north east) + (-15.00mm,0.00mm)$) ($(current page.north west) + (130.00mm,-35.00mm)$)} -- plot [smooth] coordinates {($(current page.north east) + (-15.00mm,17.00mm)$) ($(current page.north east) + (-20.83mm,0.00mm)$)} -- cycle;
%%%        \end{pgfonlayer}


        \begin{pgfonlayer}{top}
%            \draw plot [smooth] (current page.north west) + (0.00mm,-11.78mm)$) coordinates {($(current page.north west) + (118.86mm,-19.64mm)$) ($(current page.north east) + (-23.72mm,-0.00mm)$)};
%            \draw [black] ($(current page.north west) + (0.00mm,-11.78mm)$)  -- ++(118.86mm,-19.64mm) -- ($(current page.north east) + (-23.72mm,-0.00mm)$) -| cycle;
%            \draw [black] ($(current page.north east) + (-13.86mm,0.00mm)$) -- ($(current page.north east) + (-73.28mm,-23.57mm)$) -- ($(current page.north east) + (-17.83mm,0.00mm)$) --cycle;
%            \draw [black] ($(current page.north west) + (0.00mm,-11.78mm)$)-- ($(current page.north east) + (-59.42mm,-74.64mm)$) -- ($(current page.north east) + (0.00mm,-66.79mm)$) |- cycle;
%            \draw [blue, thick] ($(current page.north west) + (0.00mm,-11.78mm)$) .. controls ($(current page.north west) + (25.75mm,-35.11mm)$) and ($(current page.north west) + (65.36mm,-48.76mm)$) .. controls ($(current page.north west) + (118.83mm,-97.52mm)$) and ($(current page.north west) + (198.06mm,-97.52mm)$);
%            \draw [red] plot [smooth cycle] coordinates {($(current page.north west) + (0.00mm,-11.78mm)$) ($(current page.north west) + (45.55mm,-40.00mm)$) ($(current page.north west) + (156.46mm,-85.00mm)$) ($(current page.north east) + (0.00mm,-65.00mm)$)};

        \end{pgfonlayer}
    \end{tikzpicture}

}

\newcommand{\ChapNoNumTitle}[1]{%
    \thispagestyle{plain}
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (a) at ($(current page.north west) + (44.00mm,-44.00mm)$);

        \filldraw [fill=cor1] ($(a) + (0.00mm,-25.00mm)$) -- ++(22.00mm,0.0mm) arc [start angle=270, end angle=360, x radius = 3.00mm, y
        radius=3.00mm] coordinate (c1) -- ++(0.00mm,44.00mm) coordinate (c2) arc [start angle=0, end angle=90, x radius=3.00mm, y radius=3.00mm] --
        ++(-44.00mm,0.00mm) arc [start angle=90, end angle=180, x radius=3.00mm, y radius=3.00mm] -- ++(0.00mm,-44.00mm) arc [start angle=180, end
        angle=270, x radius=3.00mm, y radius=3.00mm] -- cycle;
%        \node[textbf, text=cor2] at (a) {\chapnamefont\thechapter};

        \coordinate (b) at ($(c1)!0.5!(c2)$);
        \node (title) at (b) [right, font=\chaptitlefont] {#1};
    \end{tikzpicture}
}
\newif\ifnumberedchap
\numberedchaptrue

% Page number command
\newcommand{\leftpagenumber}{%
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south west) + (13.50mm,6.80mm)$);
            \begin{pgfonlayer}{main}
                % Square for page number
                \filldraw [fill=cor1, draw=cor1] (bottom) rectangle ++(-8.00mm,8.00mm) coordinate (corner);
            \end{pgfonlayer}

            \begin{pgfonlayer}{foreground}
                \node [text=white, font=\bfseries](page_number) at ($(bottom)!0.5!(corner)$) {\thepage};
            \end{pgfonlayer}
    \end{tikzpicture}
}

\newcommand{\rightpagenumber}{%
    \begin{tikzpicture}[remember picture, overlay]
        \coordinate (bottom) at ($(current page.south east) + (-13.50mm,6.80mm)$);
            \begin{pgfonlayer}{main}
                % Square for page number
                \filldraw [fill=cor1, draw=cor1] (bottom) rectangle ++(8.00mm,8.00mm) coordinate (corner);
            \end{pgfonlayer}

            \begin{pgfonlayer}{foreground}
                \node [text=white, font=\bfseries](page_number) at ($(bottom)!0.5!(corner)$) {\thepage};
            \end{pgfonlayer}

    \end{tikzpicture}
}

\newcommand{\drawpage}{%
    \begin{tikzpicture}[remember picture, overlay]
        \draw [green, thick] (current page.north west) -- (current page.north east) -- (current page.south east) -- (current page.south west) -- cycle;
    \end{tikzpicture}
}


% Draw headers. This places the tabs on the side of the page
\newcommand{\leftpagetab}{%
    \begin{tikzpicture}[remember picture, overlay]
        % \filldraw [fill=cor1, draw=cor1] (current page.north east) rectangle ($(current page.south east) + (-18.00mm,0.00mm)$) coordinate (bottom) {};
        \coordinate (bottom) at ($(current page.south west) + (18.00mm,0.00mm)$);

        % Draw color block
        \filldraw [fill=cor2, draw=cor2] ($(current page.north east) + (-18.00mm,0.00mm)$) rectangle ++(8.00mm,-8.00mm) coordinate (taba) {};
        % \filldraw [fill=cor1, draw=cor1] ($(current page.north east) + (-18.00mm,0.00mm)$) -- ++(0.00,-48.00mm) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ++(5.00mm,0.00mm) arc [start angle=270, end angle=360, x radius=2.00mm, y radius=2.00mm] |- cycle;

        % Square for chapter number
        \coordinate (tabb) at ($(taba) + (-8.00mm,-8.00mm)$);
        \coordinate (tabc) at ($(tabb) + (4.00mm,0.00mm)$);
        \node [fill=cor1, text=white, minimum height=8.00mm, minimum width=8.00mm] (chapternumber) at ($(tabb)!0.5!(taba)$) {\Large\thirdtitlefont\thechapter};
        % \filldraw [fill=cor2, draw=cor2] ($(current page.north east) + (-18.00mm,-26.00mm)$) -- ++(9.00mm,0.00mm) -- ++(0.00mm,-9.00mm) -| cycle;

        % Add chapter name
        \node [fill=cor2, text=white] (chaptertitle) at (tabb) [rotate=90, below left, minimum height = 8.00mm] {\tiny\titlefont \MakeUppercase{\chaptername}};

        % Add end tab
        \fill [fill=cor2] (chaptertitle.north west) -- ++(0.00mm,-4.00mm) coordinate (t1) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm]  -- ++(4.00mm,0.00mm) arc [start angle=270, end angle=360, x radius=2.00mm, y radius=2.00mm] coordinate (t2) -| cycle;

        % Add chapter title 
        \node (chaptertitle) at ($(t1)!0.5!(t2)$) [left, rotate=90, text=black] {\tiny \pagetitlefont \leftmark};

    \end{tikzpicture}
}

\newcommand{\rightpagetab}{%
    \begin{tikzpicture}[remember picture, overlay]
        % \filldraw [fill=cor1, draw=cor1] (current page.north west) rectangle ($(current page.south west) + (18.00mm,0.00mm)$) coordinate (bottom) {};
        \coordinate (bottom) at ($(current page.south west) + (18.00mm,0.00mm)$);

        % Draw color block
        \filldraw [fill=cor2, draw=cor2] ($(current page.north west) + (18.00mm,0.00mm)$) rectangle ++(-8.00mm,-8.00mm) coordinate (taba) {};

        % Square for chapter number
        \coordinate (tabb) at ($(taba) + (8.00mm,-8.00mm)$);
        %%% \coordinate (tabc) at ($(tabb) + (4.00mm,0.00mm)$);
        \node [fill=cor1, text=white, minimum height=8.00mm, minimum width=8.00mm] (chapternumber) at ($(tabb)!0.5!(taba)$) {\Large\thirdtitlefont\thechapter};

        % Add chapter name
        \node [fill=cor2, text=white] (chaptertitle) at (tabb) [rotate=90, above left, minimum height = 8.00mm] {\tiny\titlefont \MakeUppercase{\chaptername}};

        % Add end tab
        \filldraw [fill=cor2, draw=cor2] (chaptertitle.south west) -- ++(0.00mm,-4.00mm) coordinate (t1) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- ++(-4.00mm,0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] coordinate (t2) -| cycle;

        % Add chapter title
        \node (chaptertitle) at ($(t1)!0.5!(t2)$) [left, rotate=90, text=black, xshift=-0.00mm] {\tiny\pagetitlefont\leftmark};

        % Square for page number
        % \filldraw [fill=cor1, draw=cor1] ($(bottom) + (0.00mm, 20.00mm)$) rectangle ++(8.00mm,8.00mm);
    \end{tikzpicture}
}

\let\oldnewline\newline
% redefinition: \newline is \relax
\newcommand\AnnCL{%
  \def\newline{\relax}}
% recovering the original meaning of \newline
\newcommand\RecCL{%
  \def\newline{\oldnewline}}

% Draw Headings

%%% Activity heading
%\newcommand{\activity}[1]{
%	\begin{tikzpicture}[remember picture, overlay]
%	\draw [draw=cor2] (-3.00mm,0.00mm) -- ++(0.00mm,2.00mm) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] coordinate (arc) -- ++(53.00mm,0.00mm) coordinate (line);
%	\node (title) at (arc.north east) [above right, font=\bfseries\fontsize{13pt}{0}\selectfont] {#1};
%	\filldraw [fill=cor2, draw=cor2] (line) -- ++(0.00mm,6.00mm) coordinate (line1) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -| ++(20.00mm,-6.00mm) coordinate (line2) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -- cycle;
%	\node (activity) at ($(line1)!0.5!(line2)$) [text=white, font=\titlefont] {Atividade};
%	\end{tikzpicture}
%}

%% Exploring Headins
\newcommand{\explore}[1]{%
\vspace{8 mm}
\needspace{.15\textheight}

	\noindent \begin{tikzpicture}[remember picture, scale=1.3]% overlay removed from original, otherwise the stays behind the text, scale.
        \filldraw [fill=session1, draw=session1] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (explore) at ($(a)!0.5!(b)$) [white] {\titlefont  EXPLORANDO};
        \draw [session1, thick] (b) --++ ($(\textwidth,0.00mm)+(-72 mm,0 mm)$); % changed
        \node (title) at ($(a1)!0.5!(b1)$) [right] {\large\secondtitlefont\textcolor{session1}{\MakeUppercase{ #1}}};
    \end{tikzpicture}
    \vspace{3 mm}
    
    	\def\currentcolor{session1}
	%setting depth 1 enumerate style
        \setlist[enumerate]{label=\protect\bfseries\textcolor{\currentcolor}{\alph*)}}
	% choose secondary (depth 2) enumerate style..
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{\currentcolor}{\roman*)},ref=\protect\bfseries\textcolor{\currentcolor}{\alph*)}} 

    
}

\newcommand{\practice}[1]{%
\vspace{8 mm}
\needspace{.15\textheight}

\noindent     \begin{tikzpicture}[remember picture, scale=1.3]
        \filldraw [fill=session2, draw=session2] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (practice) at ($(a)!0.5!(b)$) [white] {\titlefont PRATICANDO};
        \draw [session2, thick] (b) -- ++($(\textwidth,0.00mm)+(-72 mm,0 mm)$);
        \node (title) at ($(a1)!0.5!(b1)$) [right] { \large\secondtitlefont\textcolor{session2}{\MakeUppercase{ #1}}};
    \end{tikzpicture}
\vspace{3 mm}

	\def\currentcolor{session2}
	%setting depth 1 enumerate style
        \setlist[enumerate]{label=\protect\bfseries\textcolor{\currentcolor}{\alph*)}}
	% choose secondary (depth 2) enumerate style..
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{\currentcolor}{\roman*)},ref=\protect\bfseries\textcolor{\currentcolor}{\alph*)}} 


}

\newcommand{\know}[1]{%
\vspace{8 mm}
\needspace{.15\textheight}

\noindent     \begin{tikzpicture}[remember picture, scale=1.3]
        \filldraw [fill=session3, draw=session3] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (know) at ($(a)!0.5!(b)$) [white] {\titlefont PARA SABER \Huge{+}};
        \draw [session3, thick] (b) -- ++($(\textwidth,0.00mm)+(-72 mm,0 mm)$);
        \node (title) at ($(a1)!0.5!(b1)$) [right] {\large\secondtitlefont\textcolor{session3}{\MakeUppercase{ #1}}};
    \end{tikzpicture}
\vspace{3 mm}

	\def\currentcolor{session3}
	%setting depth 1 enumerate style
       \setlist[enumerate]{label=\protect\bfseries\textcolor{\currentcolor}{\alph*)}}
	% choose secondary (depth 2) enumerate style..
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{\currentcolor}{\roman*)},ref=\protect\bfseries\textcolor{\currentcolor}{\alph*)}} 
}

\newcommand{\arrange}[1]{%
\vspace{8 mm}
\needspace{.15\textheight}

\noindent     \begin{tikzpicture}[remember picture, scale=1.3]
        \filldraw [fill=session4, draw=session4] (-3.00mm,0.00mm) coordinate (a) -- ++(30.00mm,0.00mm) arc [start angle=90, end angle=0, x radius=2.00mm, y radius=2.00mm] coordinate (a1) -- ++(0.00mm,-2.00mm) coordinate (b1) arc [start angle=180, end angle=270, x radius=2.00mm, y radius=2.00mm] coordinate (b) -- ++(-30.00mm, 0.00mm) arc [start angle=270, end angle=180, x radius=2.00mm, y radius=2.00mm] -- ++(0.00mm,2.00mm) arc [start angle=0, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
        \node (arrange) at ($(a)!0.5!(b)$) [white] {\titlefont ORGANIZANDO};
        \draw [session4, thick] (b) -- ++($(\textwidth,0.00mm)+(-72 mm,0 mm)$);
        \node (title) at ($(a1)!0.5!(b1)$) [right] {\large\secondtitlefont\textcolor{session4}{\MakeUppercase{ #1}}\newline};
    \end{tikzpicture}
\vspace{3 mm}

	\def\currentcolor{session4}
	%setting depth 1 enumerate style
        \setlist[enumerate]{label=\protect\bfseries\textcolor{\currentcolor}{\alph*)}}
	% choose secondary (depth 2) enumerate style..
	\setlist[enumerate,2]{label=\protect\bfseries\textcolor{\currentcolor}{\roman*)},ref=\protect\bfseries\textcolor{\currentcolor}{\alph*)}} 

}

%% Exercise section
\newcommand{\exercise}{
\vspace{8 mm}
\needspace{.15\textheight}

	\noindent \begin{tikzpicture}[remember picture]
	\draw [draw=cor2, very thick] (-3.00mm,0.00mm) -- ++(0.00mm,2.00mm) -- ++(\textwidth , 0.00mm) -- ++(0mm,-2mm);% line
	\fill [draw=cor2, very thick , fill=cor1] ($(\textwidth/2 , 0mm) + (19mm,6mm)$) -- ++(0.00mm,-5.5 mm) coordinate (line1) arc [start angle=0, end angle=-90, x radius=2.00mm, y radius=2.00mm] -| ++(-38.00mm , 0.00mm)  -- ++ (0mm, 5.5 mm) coordinate (line2) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -- cycle;
	\node (exercise) at ($(line1)!0.5!(line2) + (0 mm, .8 mm)$) [text=white, font=\thirdtitlefont\Large] {EXERCÍCIOS};%\fontsize{13pt}{0}
	\end{tikzpicture}
	\vspace{8 mm}
    \def\currentcolor{cor1}
	
	\setlist[enumerate]{label=\protect\enumbox{\arabic*}}
	\setlist[enumerate,2]{label=\emph{\alph*)},ref=\theenumi.\emph{\arabic*}}
	}

% Defining the section style for the diferent names that eventually appear.
\setsecnumdepth{chapter} % just number the chapter, not lower levels.

% Clear page after chapter title
\renewcommand\memendofchapterhook{%
    \clearpage\m@mindentafterchapter\@afterheading}

% Setup page
\makechapterstyle{livroaberto}{%
    \renewcommand{\chapnamefont}{}
    \renewcommand{\chapnumfont}{\titlefont\bfseries\fontsize{140pt}{0}\selectfont}
    \renewcommand{\chaptitlefont}{\titlefont\bfseries\fontsize{25pt}{0}\selectfont}
    \renewcommand{\chapternamenum}{}
    \renewcommand{\afterchapternum}{}
    \renewcommand{\printchaptername}{}
    \renewcommand{\printchapternum}{}
    \renewcommand{\printchapternonum}{\global\numberedchapfalse}
    \renewcommand{\printchaptertitle}[1]{%
    \thispagestyle{plain}
        \ifnumberedchap
            \ChapNumTitle{##1}
        \else
            \ChapNoNumTitle{##1}
        \fi
        \global\numberedchaptrue
        }
    \renewcommand{\afterchaptertitle}{\clearpage}
%    \setlength{\beforechapskip}{}
%    \setlength{\midchapskip}{}
%    \setlength{\afterchapskip}{}

}
\renewcommand{\chaptermarksn}[1]{}


\makepagestyle{plain}
\makeevenfoot{plain}{}{\leftpagenumber}{}
\makeoddfoot{plain}{}{\rightpagenumber}{}

\makepagestyle{livroaberto}

\makeevenfoot{livroaberto}{}{\leftpagenumber}{}
\makeoddfoot{livroaberto}{}{\rightpagenumber}{}
\makeevenhead{livroaberto}{}{\rightpagetab}{}
\makeoddhead{livroaberto}{}{\leftpagetab}{}


\chapterstyle{livroaberto}
\pagestyle{livroaberto}

%Seção 5 - Livro Aberto Lists

%***************************************************************************************
% This package creates the heading designs for the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
%
%

% \def\fileversion{v1.0}
% \def\filename{livroabertolists}
% \def\filetitle{Livro Aberto Lists package}
% \def\filedate{2018/02/13}
% \def\docdate {2018/02/13}


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{\filename}

\typeout{Package: `\filetitle\space\filename\space\fileversion \@spaces <\filedate>'}
\typeout{English documentation as of <\docdate>}

%% ---------------------------------------------------------------------
%%
%% Loads the ifthen package
%%
\RequirePackage{ifthen}

\RequirePackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{shapes, decorations}
\usetikzlibrary{intersections,through,backgrounds,fit}
\RequirePackage{tikzpagenodes}
\RequirePackage[inline]{enumitem}




\pgfdeclareshape{enumbox}{%
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]

    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}

    \backgroundpath{%
        \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya+2pt}}
        \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb-2pt}{\pgf@yb}}
        \pgfpatharc{90}{0}{2.0pt}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xa+2pt}{\pgf@ya}}
        \pgfpatharc{270}{180}{2.0pt}
%        \pgfpathcurveto{\pgfpoint{\pgf@xc}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@ya}\pgfpoint{\pgf@xa}{\pgf@yc}}
        \pgfpathclose
    }
}

\pgfdeclareshape{itembox}{%
    \inheritsavedanchors[from=rectangle]
    \inheritanchorborder[from=rectangle]

    \inheritanchor[from=rectangle]{center}
    \inheritanchor[from=rectangle]{south}
    \inheritanchor[from=rectangle]{west}
    \inheritanchor[from=rectangle]{north}
    \inheritanchor[from=rectangle]{east}
    \inheritanchor[from=rectangle]{base}

    \backgroundpath{%
        \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y

% Construct main path
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
        \pgfpathclose
    }
}

\newcommand*{\enumbox}[1]{%
    \tikz [baseline=(numbereditem.base)]{%
        \node[shape=enumbox,text=white, font=\bfseries\fontsize{11pt}{0}\selectfont, draw=black, 
        fill=cor1, 
        minimum width=6.00mm, minimum height=6.00mm] (numbereditem) {#1};
    }
}

\newcommand*{\enumdefault}[1]{%
    \tikz [baseline=(numbereditem.base)]{%
        \node[shape=enumbox, font=\bfseries\fontsize{11pt}{0}\selectfont, draw=black, minimum width=6.00mm, minimum height=6.00mm] (numbereditem) {#1};
    }
}


% Defining an alternative shape for itemize, where the bullets are actually squares.
\newcommand*{\itembox}{%
    \tikz [baseline=(boxitem.base)] {%
        \node[shape=rectangle, draw=black, minimum width=6.00mm, minimum height=6.00mm] (boxitem) {};
    }
}

% Defining an alternative shape for itemize, where the bullets are actually colored squares.
\newcommand*{\itemcoloredsquare}{%
    \tikz [baseline=(boxitem.base)] {%
        \node[shape=rectangle, fill=\currentcolor, minimum width=1.50mm, minimum height=1.50mm] (boxitem) {};
    }
}


% Set up lists
\setlist[enumerate]{label=\protect\enumbox{\alph*)}}
%\setlist[itemize]{label=\protect\itembox}
\setlist[itemize]{label=\protect\itemcoloredsquare}


%Seção 6 - Livro Aberto Page

%***************************************************************************************
% This package sets up the page dimensions used in the Livro Aberto textbook.
%
% This package was written and created by
% David Latchman, TeXnical Designs
% Contact: david.latchman@texnical-designs.com for problems
%
%

% \def\fileversion{v1.0}
% \def\filename{livroabertopage}
% \def\filetitle{Livro Aberto page package}
% \def\filedate{2018/02/13}
% \def\docdate {2018/02/13}


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{\filename}

\typeout{Package: `\filetitle\space\filename\space\fileversion \@spaces <\filedate>'}
\typeout{English documentation as of <\docdate>}

%% ---------------------------------------------------------------------
%%
%% Loads the ifthen package
%%
\RequirePackage{ifthen}


\RequirePackage{booktabs}
\RequirePackage{url}
\RequirePackage{graphicx}
%\RequirePackage[usenames,dvipsnames]{color}
\RequirePackage{forloop}
\RequirePackage{lipsum}
\RequirePackage{microtype}
\RequirePackage{suffix}
\RequirePackage{etoolbox}
\RequirePackage{refcount}
% \RequirePackage[hidelinks]{hypreref}
\RequirePackage{xcolor}
\RequirePackage{multicol}
\RequirePackage{etex}

%\RequirePackage[brazilian]{babel}
\RequirePackage{blindtext}

\RequirePackage{cleveref}

%% Set Page Size
% \setstocksize{11.00in}{8.50in}
\setstocksize{275mm}{204mm}
\settrimmedsize{275mm}{204mm}{*}
% \setstocksize{275mm}{204mm}
% \settrimmedsize{\stockheight}{\stockwidth}{*}


% \settrims{2.20mm}{5.95mm}

\settypeblocksize{241mm}{162mm}{*}
\setlrmarginsandblock{20mm}{22mm}{*}
\setulmarginsandblock{17mm}{17.00mm}{*}

% \setlrmargins{*}{1.25in}{*}
% \setulmargins{*}{*}{0.85}
% \setlrmarginsandblock{1.00in}{1.00in}{*}
\setcolsepandrule{8.00mm}{0mm}


% Set Paragraphs to no indent with a 6pt space between paragraphs
\setlength{\parindent}{0em}
 \setlength{\parskip}{6pt}

%% Modify Header and Footer spacing
% \setheadfoot{\onelineskip}{2\onelineskip}

\checkandfixthelayout

% Add some of the required graphics pacjakes to make things work
\RequirePackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{shapes, decorations}
\usetikzlibrary{intersections,through,backgrounds}
\usetikzlibrary{positioning,fit}
\RequirePackage{tikzpagenodes}

\RequirePackage{environ}

% Define the layers to be used in document.
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfdeclarelayer{top}
\pgfdeclarelayer{bottom}
\pgfsetlayers{bottom,background,main,foreground,top}




% \NewEnviron{exercise}{%
%     \newpage
% 	\begin{tikzpicture}[remember picture, overlay]
% 		\coordinate (a) at ($(current page text area.north west) + (0.00mm,-5.00mm)$);
% 		\coordinate (b) at ($(current page text area.north east) + (0.00mm,-5.00mm)$);
% 		\coordinate (c) at ($(current page text area.north) + (-19.00mm,0.00mm)$);
% 		\coordinate (d) at ($(current page text area.north) + (19.00mm,0.00mm)$);
% 		\coordinate (title) at ($(current page text area.north) + (0.00mm,0.00mm)$);
%         \coordinate (text) at ($(current page text area.north) + (0.00mm,-8.50mm)$);
		
% 		\begin{pgfonlayer}{background}
% 			\draw [black] (a) |- (c);
% 			\draw [draw=black, fill=cor1] (c) -- ++(0.00mm,1.50mm) arc [start angle=180, end angle=90, x radius=2.00mm, y radius=2.00mm] -| (d) -- ++(0.00mm,-1.50mm) arc [start angle=360, end angle=270, x radius=2.00mm, y radius=2.00mm] -| cycle;
% 			\draw [black] (d) -| (b);
% 		\end{pgfonlayer}
		
% 		\begin{pgfonlayer}{foreground}
% 			\node [white, font=\titlefont\bfseries\fontsize{13pt}{0}\selectfont] (heading) at (title) {EXERCICOS};
%            \node [box, below] (bodytext) at (text){%
% 			\begin{minipage}{\textwidth}
%                 \begin{multicols}{2}
% 				    \BODY
%                 \end{multicols}			
% 			\end{minipage}	
% 			};
% 		\end{pgfonlayer}	
		
% 	\end{tikzpicture}
%     \clearpage
% }



\endinput


% \RenewEnviron{sphinxadmonition}[3]
% {\ifthenelse{\equal{#2}{Resposta}}% if this, use the style below
%   {  }
%   {\ifthenelse{\equal{#2}{Para o professor}}% if this, use the style below
%   	{  }
% 	{\ifthenelse{\equal{#2}{Atividade}} % if this, use the style below
% 		{\begin{task}{#3}
% 		  \BODY \\
% 		  \end{task}
% 		}
% 	  	{\ifthenelse{\equal{#2}{Para refletir}}%  should close the environment in the right way
% 			{ \begin{reflection}
% 			  \BODY \\
% 			  \end{reflection}
% 			}
% 			{\ifthenelse{\equal{#2}{Você sabia?}} % if this, use the style below
% 				{\begin{knowledge}
% 				  \BODY \\
% 				  \end{knowledge}
% 				}
% 				{\ifthenelse{\equal{#2}{Para pesquisar}}% if Para pesquisar, use the style below
% 		     			{\begin{research}
% 		     			 \BODY \\
% 		     			 \end{research}
% 		     			}
% 		     		     	{\ifthenelse{\equal{#2}{Auto-avaliação}}% if Para pesquisar, use the style below
% 		     				{\begin{evaluation}
% 		     				 \BODY \\
% 		     				 \end{evaluation}
% 		     				 }
% 		     		     		{\ifthenelse{\equal{#2}{Exemplo}}% if Para pesquisar, use the style below
% 		     					{\begin{example}{#3}
% 		     					 \BODY \\
% 		     					 \end{example}
% 		     					}
% 		     					 {\ifthenelse{\equal{#2}{Observação}}% if Para pesquisar, use the style below
% 			     					{\begin{observation}{#3}
% 			     					 \BODY \\
% 			     					 \end{observation}
% 			     					}
% 			     					{
% 			     					\begin{observation}{#3}
% 			     					\BODY \\	     					     
% 								\end{observation}
% 								}
% 							}
% 						}
% 					}
% 				}
% 			}
% 		}
% 	}
% }
% }



